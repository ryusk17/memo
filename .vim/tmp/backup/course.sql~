ET SESSION FOREIGN_KEY_CHECKS=0;

/* Drop Database */
DROP DATABASE IF EXISTS `toshin_course_guide`;
/* Create Database */
CREATE DATABASE IF NOT EXISTS `toshin_course_guide` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

use `toshin_course_guide`;

/* Drop Tables */

DROP TABLE IF EXISTS courses_categories;
DROP TABLE IF EXISTS categories;
DROP TABLE IF EXISTS courses_grades;
DROP TABLE IF EXISTS courses_levels;
DROP TABLE IF EXISTS courses_teachers;
DROP TABLE IF EXISTS courses_texts;
DROP TABLE IF EXISTS courses;
DROP TABLE IF EXISTS grades;
DROP TABLE IF EXISTS import_aliases;
DROP TABLE IF EXISTS levels_details;
DROP TABLE IF EXISTS levels;
DROP TABLE IF EXISTS types_subjects;
DROP TABLE IF EXISTS subjects;
DROP TABLE IF EXISTS types;




/* Create Tables */

-- カテゴリーテーブル
-- CREATE TABLE categories
-- (
    --  id int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
    --      name varchar(32) DEFAULT '' NOT NULL COMMENT 'カテゴリー名',
    --          type_id int(11) DEFAULT 0 NOT NULL COMMENT '講座区分id',
    --              detail varchar(255) DEFAULT '' NOT NULL COMMENT '詳細',
    --                  display_order int(11) DEFAULT 0 NOT NULL COMMENT '順序',
    --                      created datetime NOT NULL COMMENT '作成日付',
    --                          modified datetime NOT NULL COMMENT '更新日付',
    --                              deleted datetime COMMENT '削除日付',
    --                                  PRIMARY KEY (id)
    --                                  ) ENGINE = InnoDB COMMENT = 'カテゴリーテーブル' DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
--
--
--                                  -- 講座テーブル
--                                  CREATE TABLE courses
--                                  (
    --                                      id int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
    --                                          subject_id int(11) DEFAULT 0 NOT NULL COMMENT '教科id',
    --                                              code int(11) DEFAULT 0 NOT NULL COMMENT '講座コード',
    --                                                  type_id int(11) DEFAULT 0 NOT NULL COMMENT '講座区分id',
    --                                                      name varchar(255) DEFAULT '' NOT NULL COMMENT '講座名',
    --                                                          lesson_minutes int(11) DEFAULT 0 NOT NULL COMMENT '授業分数',
    --                                                              lesson_times int(11) DEFAULT 0 NOT NULL COMMENT 'コマ数',
    --                                                                  completion_test int(11) DEFAULT 0 NOT NULL COMMENT '修了判定テスト',
    --                                                                      new_course tinyint(1) DEFAULT 0 NOT NULL COMMENT '新規開講',
    --                                                                          headline text NOT NULL COMMENT '見出し',
    --                                                                              target text NOT NULL COMMENT '講座の対象',
    --                                                                                  objective text NOT NULL COMMENT '講座の目標',
    --                                                                                      items text NOT NULL COMMENT '学習項目',
    --                                                                                          contents text NOT NULL COMMENT '学習内容',
    --                                                                                              important_point text NOT NULL COMMENT '受講上の注意点',
    --                                                                                                  prelearning_course text NOT NULL COMMENT '事前受講講座例',
    --                                                                                                      add_info text NOT NULL COMMENT '追加情報',
    --                                                                                                          year int(11) COMMENT '年度',
    --                                                                                                              audio_file tinyint(1) DEFAULT 0 NOT NULL COMMENT '音声ファイル',
    --                                                                                                                  created datetime NOT NULL COMMENT '作成日付',
    --                                                                                                                      modified datetime NOT NULL COMMENT '更新日付',
    --                                                                                                                          deleted datetime COMMENT '削除日付',
    --                                                                                                                              PRIMARY KEY (id)
    --                                                                                                                              ) ENGINE = InnoDB COMMENT = '講座テーブル' DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
--
--
--                                                                                                                              -- 講座-カテゴリーリンクテーブル
--                                                                                                                              CREATE TABLE courses_categories
--                                                                                                                              (
    --                                                                                                                                  id int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
    --                                                                                                                                      course_id int(11) DEFAULT 0 NOT NULL COMMENT '講座id',
    --                                                                                                                                          category_id int(11) DEFAULT 0 NOT NULL COMMENT 'カテゴリーid',
    --                                                                                                                                              created datetime NOT NULL COMMENT '作成日付',
    --                                                                                                                                                  modified datetime NOT NULL COMMENT '更新日付',
    --                                                                                                                                                      deleted datetime COMMENT '削除日付',
    --                                                                                                                                                          PRIMARY KEY (id)
    --                                                                                                                                                          ) ENGINE = InnoDB COMMENT = '講座-カテゴリーリンクテーブル' DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
--
--
--                                                                                                                                                          -- 講座-学年リンクテーブル
--                                                                                                                                                          CREATE TABLE courses_grades
--                                                                                                                                                          (
    --                                                                                                                                                              id int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
    --                                                                                                                                                                  course_id int(11) DEFAULT 0 NOT NULL COMMENT '講座id',
    --                                                                                                                                                                      grade_id int(11) DEFAULT 0 NOT NULL COMMENT '学年id',
    --                                                                                                                                                                          created datetime NOT NULL COMMENT '作成日付',
    --                                                                                                                                                                              modified datetime NOT NULL COMMENT '更新日付',
    --                                                                                                                                                                                  deleted datetime COMMENT '削除日付',
    --                                                                                                                                                                                      PRIMARY KEY (id)
    --                                                                                                                                                                                      ) ENGINE = InnoDB COMMENT = '講座-学年リンクテーブル' DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
--
--
--                                                                                                                                                                                      -- 講座-レベルリンクテーブル
--                                                                                                                                                                                      CREATE TABLE courses_levels
--                                                                                                                                                                                      (
    --                                                                                                                                                                                          id int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
    --                                                                                                                                                                                              course_id int(11) DEFAULT 0 NOT NULL COMMENT '講座id',
    --                                                                                                                                                                                                  level_id int(11) DEFAULT 0 NOT NULL COMMENT 'レベルid',
    --                                                                                                                                                                                                      created datetime NOT NULL COMMENT '作成日付',
    --                                                                                                                                                                                                          modified datetime NOT NULL COMMENT '更新日付',
    --                                                                                                                                                                                                              deleted datetime COMMENT '削除日付',
    --                                                                                                                                                                                                                  PRIMARY KEY (id)
    --                                                                                                                                                                                                                  ) ENGINE = InnoDB COMMENT = '講座-レベルリンクテーブル' DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
--
--
--                                                                                                                                                                                                                  -- 講座-講師リンクテーブル
--                                                                                                                                                                                                                  CREATE TABLE courses_teachers
--                                                                                                                                                                                                                  (
    --                                                                                                                                                                                                                      id int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
    --                                                                                                                                                                                                                          course_id int(11) DEFAULT 0 NOT NULL COMMENT '講座id',
    --                                                                                                                                                                                                                              -- toshin_database.teachers.id
    --                                                                                                                                                                                                                                  teacher_id int(11) DEFAULT 0 NOT NULL COMMENT '講師id : toshin_database.teachers.id',
    --                                                                                                                                                                                                                                      created datetime NOT NULL COMMENT '作成日付',
    --                                                                                                                                                                                                                                          modified datetime NOT NULL COMMENT '更新日付',
    --                                                                                                                                                                                                                                              deleted datetime COMMENT '削除日付',
    --                                                                                                                                                                                                                                                  PRIMARY KEY (id)
    --                                                                                                                                                                                                                                                  ) ENGINE = InnoDB COMMENT = '講座-講師リンクテーブル' DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
--
--
--                                                                                                                                                                                                                                                  -- 講座全文テーブル
--                                                                                                                                                                                                                                                  CREATE TABLE courses_texts
--                                                                                                                                                                                                                                                  (
    --                                                                                                                                                                                                                                                      id int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
    --                                                                                                                                                                                                                                                          course_id int(11) DEFAULT 0 NOT NULL COMMENT '講座id',
    --                                                                                                                                                                                                                                                              full_text text NOT NULL COMMENT '全文',
    --                                                                                                                                                                                                                                                                  created datetime NOT NULL COMMENT '作成日付',
    --                                                                                                                                                                                                                                                                      modified datetime NOT NULL COMMENT '更新日付',
    --                                                                                                                                                                                                                                                                          deleted datetime COMMENT '削除日付',
    --                                                                                                                                                                                                                                                                              PRIMARY KEY (id)
    --                                                                                                                                                                                                                                                                              ) ENGINE = InnoDB COMMENT = '講座全文テーブル' DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
--
--
--                                                                                                                                                                                                                                                                              -- 学年テーブル
--                                                                                                                                                                                                                                                                              CREATE TABLE grades
--                                                                                                                                                                                                                                                                              (
    --                                                                                                                                                                                                                                                                                  id int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
    --                                                                                                                                                                                                                                                                                      name varchar(32) DEFAULT '' NOT NULL COMMENT '学年名',
    --                                                                                                                                                                                                                                                                                          new_name varchar(32) DEFAULT '' NOT NULL COMMENT '新学年名',
    --                                                                                                                                                                                                                                                                                              type_id int(11) DEFAULT 0 NOT NULL COMMENT '講座区分id',
    --                                                                                                                                                                                                                                                                                                  display_order int(11) DEFAULT 0 NOT NULL COMMENT '順序',
    --                                                                                                                                                                                                                                                                                                      created datetime NOT NULL COMMENT '作成日付',
    --                                                                                                                                                                                                                                                                                                          modified datetime NOT NULL COMMENT '更新日付',
    --                                                                                                                                                                                                                                                                                                              deleted datetime COMMENT '削除日付',
    --                                                                                                                                                                                                                                                                                                                  PRIMARY KEY (id)
    --                                                                                                                                                                                                                                                                                                                  ) ENGINE = InnoDB COMMENT = '学年テーブル' DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
--
--
--                                                                                                                                                                                                                                                                                                                  -- エイリアステーブル : インポート用エイリアス
--                                                                                                                                                                                                                                                                                                                  CREATE TABLE import_aliases
--                                                                                                                                                                                                                                                                                                                  (
    --                                                                                                                                                                                                                                                                                                                      id int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
    --                                                                                                                                                                                                                                                                                                                          table_name varchar(16) DEFAULT '' NOT NULL COMMENT 'テーブル',
    --                                                                                                                                                                                                                                                                                                                              value varchar(255) DEFAULT '' NOT NULL COMMENT '値',
    --                                                                                                                                                                                                                                                                                                                                  target_id int(11) DEFAULT 0 NOT NULL COMMENT '対象id',
    --                                                                                                                                                                                                                                                                                                                                      created datetime NOT NULL COMMENT '作成日付',
    --                                                                                                                                                                                                                                                                                                                                          modified datetime NOT NULL COMMENT '更新日付',
    --                                                                                                                                                                                                                                                                                                                                              deleted datetime COMMENT '削除日付',
    --                                                                                                                                                                                                                                                                                                                                                  PRIMARY KEY (id)
    --                                                                                                                                                                                                                                                                                                                                                  ) ENGINE = InnoDB COMMENT = 'エイリアステーブル : インポート用エイリアス' DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
--
--
--                                                                                                                                                                                                                                                                                                                                                  -- レベルテーブル
--                                                                                                                                                                                                                                                                                                                                                  CREATE TABLE levels
--                                                                                                                                                                                                                                                                                                                                                  (
    --                                                                                                                                                                                                                                                                                                                                                      id int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
    --                                                                                                                                                                                                                                                                                                                                                          name varchar(64) DEFAULT '' NOT NULL COMMENT 'レベル名',
    --                                                                                                                                                                                                                                                                                                                                                              type_id int(11) DEFAULT 0 NOT NULL COMMENT '講座区分id',
    --                                                                                                                                                                                                                                                                                                                                                                  display_order int(11) DEFAULT 0 NOT NULL COMMENT '順序',
    --                                                                                                                                                                                                                                                                                                                                                                      created datetime NOT NULL COMMENT '作成日付',
    --                                                                                                                                                                                                                                                                                                                                                                          modified datetime NOT NULL COMMENT '更新日付',
    --                                                                                                                                                                                                                                                                                                                                                                              deleted datetime COMMENT '削除日付',
    --                                                                                                                                                                                                                                                                                                                                                                                  PRIMARY KEY (id)
    --                                                                                                                                                                                                                                                                                                                                                                                  ) ENGINE = InnoDB COMMENT = 'レベルテーブル' DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
--
--
--                                                                                                                                                                                                                                                                                                                                                                                  -- レベル詳細テーブル
--                                                                                                                                                                                                                                                                                                                                                                                  CREATE TABLE levels_details
--                                                                                                                                                                                                                                                                                                                                                                                  (
    --                                                                                                                                                                                                                                                                                                                                                                                      id int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
    --                                                                                                                                                                                                                                                                                                                                                                                          level_id int(11) DEFAULT 0 NOT NULL COMMENT 'レベルid',
    --                                                                                                                                                                                                                                                                                                                                                                                              univ_type int(11) DEFAULT 0 NOT NULL COMMENTON DELETE RESTRICT
    --                                                                                                                                                                                                                                                                                                                                                                                              ;
    --
    --
    --                                                                                                                                                                                                                                                                                                                                                                                              ALTER TABLE courses
    --                                                                                                                                                                                                                                                                                                                                                                                                  ADD FOREIGN KEY (type_id)
    --                                                                                                                                                                                                                                                                                                                                                                                                      REFERENCES types (id)
    --                                                                                                                                                                                                                                                                                                                                                                                                          ON UPDATE RESTRICT
    --                                                                                                                                                                                                                                                                                                                                                                                                              ON DELETE RESTRICT
    --                                                                                                                                                                                                                                                                                                                                                                                                              ;
    --
    --
    --                                                                                                                                                                                                                                                                                                                                                                                                              ALTER TABLE grades
    --                                                                                                                                                                                                                                                                                                                                                                                                                  ADD FOREIGN KEY (type_id)
    --                                                                                                                                                                                                                                                                                                                                                                                                                      REFERENCES types (id)
    --                                                                                                                                                                                                                                                                                                                                                                                                                          ON UPDATE RESTRICT
    --                                                                                                                                                                                                                                                                                                                                                                                                                              ON DELETE RESTRICT
    --                                                                                                                                                                                                                                                                                                                                                                                                                              ;
    --
    --
    --                                                                                                                                                                                                                                                                                                                                                                                                                              ALTER TABLE levels
    --                                                                                                                                                                                                                                                                                                                                                                                                                                  ADD FOREIGN KEY (type_id)
    --                                                                                                                                                                                                                                                                                                                                                                                                                                      REFERENCES types (id)
    --                                                                                                                                                                                                                                                                                                                                                                                                                                          ON UPDATE RESTRICT
    --                                                                                                                                                                                                                                                                                                                                                                                                                                              ON DELETE RESTRICT
    --                                                                                                                                                                                                                                                                                                                                                                                                                                              ;
    --
    --
    --                                                                                                                                                                                                                                                                                                                                                                                                                                              ALTER TABLE types_subjects
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                  ADD FOREIGN KEY (type_id)
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                      REFERENCES types (id)
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                          ON UPDATE RESTRICT
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              ON DELETE RESTRICT
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              ;
    --
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              CREATE FULLTEXT INDEX ngram_idx ON courses_texts(full_text) WITH PARSER ngram;
    --
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              /* Create Indexes */
    --
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              CREATE INDEX deleted ON categories (deleted ASC);
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              CREATE INDEX deleted ON courses (deleted ASC);
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              CREATE INDEX deleted ON courses_categories (deleted ASC);
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              CREATE INDEX deleted ON courses_grades (deleted ASC);
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              CREATE INDEX deleted ON courses_levels (deleted ASC);
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              CREATE INDEX deleted ON courses_teachers (deleted ASC);
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              CREATE INDEX deleted ON courses_texts (deleted ASC);
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              CREATE INDEX deleted ON grades (deleted ASC);
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              CREATE 
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                              )
--                                                                                                                                                                                                                                                                                                                                                                                                                                                              )
--                                                                                                                                                                                                                                                                                                                                                                                                                                                              )
--                                                                                                                                                                                                                                                                                                                                                                                                                                                              )
--                                                                                                                                                                                                                                                                                                                                                                                                                                                              )
--                                                                                                                                                                                                                                                                                                                                                                                                                                                              )
--                                                                                                                                                                                                                                                                                                                                                                                                                                                              )
--                                                                                                                                                                                                                                                                                                                                                                                                                                                              )
--                                                                                                                                                                                                                                                                                                                                                                                                                                                              )
--                                                                                                                                                                                                                                                                                                                                                                                                                                                              )
--                                                                                                                                                                                                                                                                                                                                                                                                                                                              )
